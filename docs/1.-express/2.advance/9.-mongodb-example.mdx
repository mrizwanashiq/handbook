---
sidebar_position: 3
id: mongodb-example
title: MongoDB Practical Example
# description: 
slug: mongodb-example
---

## Let's Start Coding

We learned basic and advanced concepts in the previous blog. Now we'll implement MongoDB in express project

First of all, I'll create a new project. So create a folder, I am creating one name express-with-mongodb. If you followed my last docs, then you already know how to create projects and do basic code. I'll repeat that, and will add code that how to use MongoDB with that.
```bash
mkdir 1.-express-with-mongodb
```
Now go to express-with-mongodb directory (folder)
```bash
cd 1.-express-with-mongodb
```
Now run this command to create a project
```bash
npm init
```
For now, just press enter, enter. And it will create a `package.json`. And run this command to install `express`, `body-parser`, `cors`, `mongoose` (mongoose is an ORM, that we'll use to do interaction with MongoDB)
```bash
npm install 1.-express body-parser cors mongoose nodemon
```
Now I am doing some changes to `package.json` file, and the final version of it is:
```json
{
    "name": "1.-express-with-mongodb",
    "version": "1.0.0",
    "description": "test project",
    "main": "index.js",
    "type": "module",
    "scripts": {
        "start": "node index.js",
        "dev": "nodemon index.js"
    },
    "author": "",
    "license": "ISC",
    "dependencies": {
        "body-parser": "^1.19.0",
        "cors": "^2.8.5",
        "express": "^4.17.3",
        "mongoose": "^6.3.3",
        "nodemon": "^2.0.15"
    }
}
```

## Our file/folder structure will be like this:

    |_ express-with-mongodb

        |_ models

            |_ book.js

        |_ index.js

        |_ node_modules

        |_ routes

            |_ book.js

        |_ package-lock.json

        |_ package.json

### `index.js`:
```js
import express from "express";
import bodyparser from "body-parser";
import cors from "cors";
import mongoose from "mongoose"
import bookRouter from "./routes/book.js";

const app = express();
app.use(bodyparser.json());
app.use(cors());

// Below code is connecting our Express App to MongoDB 
const connection = mongoose.connection
connection.once("connected", () => console.log("Database Connected ~"))
connection.on("error", error => console.log("Database Error: ", error))
mongoose.connect("mongodb://localhost:27017/my_first_data_base", {
    useNewUrlParser: true,
    useUnifiedTopology: true,
})

/**
 * 1. First, we created a connection variable and assigned it to the mongoose.connection
 * 
 * 2. connection.once is a function that will run once the connection is established
 * and will print out the message "Database Connected"
 * 
 * 3. connection.on is a function that will run every time there is an error
 * and will print out the message "Database Error: " and the error
 * 
 * 4. mongoose.connect is a function that will connect to the database
 * and will use the connection string "mongodb://localhost:27017/my_first_data_base"
 * We are using localhost because we are running the database locally
 * localhost:27017 is the port number
 * my_first_data_base is the name of the database
 */

app.use("/book", bookRouter);

app.listen(9999)
```
### `models/book.js`:
After the previous necessary explanations, we can now focus on writing our person schema and compiling a model from it.

A schema in Mongoose maps to a MongoDB collection and defines the format for all documents on that collection. All properties inside the schema must have an assigned SchemaType. 

To do interaction with the MongoDB we also need to create schema AKA models
 * We will create a model for the book collection
 * We will define the schema with the following properties:
     * name: String
     * author: String
     * price: Number 
     * stock: Number
 * We will use this model to do CRUD operations on the book collection
 * We will import the model and use it in the routes

```js
import mongoose from "mongoose";

const schema = mongoose.Schema({
    name: { type: String, required: true,},
    author: { type: String, required: true },
    price: { type: Number, required: true },
    stock: { type: Number },
});

// "Book" will be the collection's name.
const bookModel = mongoose.model("Book", schema);

// I am exporting it because I have to use it in routes
export default bookModel;
```

## `routes/book.js`:

Here, I'll create CRUD, that will create, read, get by ID, update, update, and delete in the database
```js
import express from "express";
const router = express.Router();
import bookModel from "../models/book.js";

router.get("/", async (req, res) => {
    /**
        * I am using a try-catch block to handle the error
        * if there is any error in the code
        * it will be handled by the catch block
        * and the error will be returned via the response
        * and the user will be notified
        * 
        * And I will use the try-catch block everywhere in the code
        * where there is a possibility of error because it is a good practice
        * I don't want to crash the whole application if there is an error
        * I want to handle the error and return the user a response
        */

    try {
        const books = await bookModel.find();
        res.json(books);
    } catch (err) {
        res.json({ message: err });
    }
})

router.get("/:id", async (req, res) => {
    try {
        const book = await book.findById(req.params.id);
        res.json(book);
    } catch (err) {
        res.json({ message: err });
    }
})

router.post("/", async (req, res) => {
    try {
        const result = await bookModel.create(req.body);
        res.status(200).json(result);
    } catch (err) {
        res.json({ message: err });
    }
})

router.patch("/:id", async (req, res) => {
    try {
        const result = await bookModel.findByIdAndUpdate(req.params.id, req.body);
        res.status(200).json(result);
    } catch (err) {
        res.json({ message: err });
    }
})

router.delete("/:id", async (req, res) => {
    try {
        const result = await bookModel.findByIdAndDelete(req.params.id);
        res.status(200).json(result);
    } catch (err) {
        res.json({ message: err });
    }
})

export default router;
```
Read and understand the code, and flow. 

## Code
You can download the related code from [here](https://github.com/mrizwanashiq/learning-express-js/tree/example/express-with-mongodb-code)
