"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4696],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||r;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6390:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var a=n(7462),o=(n(7294),n(3905));const r={sidebar_position:4,id:"jwt",title:"JSON Web Token (JWT)",slug:"jwt"},i=void 0,s={unversionedId:"express/advance/jwt",id:"express/advance/jwt",title:"JSON Web Token (JWT)",description:"Introduction",source:"@site/docs/1.-express/2.advance/10.jwt.mdx",sourceDirName:"1.-express/2.advance",slug:"/express/advance/jwt",permalink:"/docs/express/advance/jwt",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/1.-express/2.advance/10.jwt.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,id:"jwt",title:"JSON Web Token (JWT)",slug:"jwt"},sidebar:"tutorialSidebar",previous:{title:"MongoDB Practical Example",permalink:"/docs/express/advance/mongodb-example"},next:{title:"Validation using Joi",permalink:"/docs/express/advance/joi"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Advantages of authentication with JWT",id:"advantages-of-authentication-with-jwt",level:2},{value:"The Need for JSON Web Token",id:"the-need-for-json-web-token",level:2},{value:"Structure of a JWT",id:"structure-of-a-jwt",level:3},{value:"JWT Use Cases",id:"jwt-use-cases",level:2},{value:"Step 1: Generating a JWT",id:"step-1-generating-a-jwt",level:2},{value:"Step 2: Verifying (Authenticating) a JWT",id:"step-2-verifying-authenticating-a-jwt",level:2},{value:"How to send JWT from Postman",id:"how-to-send-jwt-from-postman",level:2},{value:"Code",id:"code",level:2}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"JSON Web Tokens (JWTs) support authorization and information exchange."),(0,o.kt)("p",null,"One common use case is for allowing clients to preserve their session information after logging in. By storing the session information locally and passing it to the server for authentication when making requests, the server can trust that the client is a registered user."),(0,o.kt)("h2",{id:"advantages-of-authentication-with-jwt"},"Advantages of authentication with JWT"),(0,o.kt)("p",null,"Authentication with JWT has several advantages over the traditional authentication process, primarily the scalability of stateless applications. And since it's becoming popular among such heavyweights as Facebook and Google, its adoption across the industry likely will continue to grow. "),(0,o.kt)("p",null,"Other advantages include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Simple verification through a JSON Web Token "),(0,o.kt)("li",{parentName:"ul"},"You can use an authentication service or outsource it"),(0,o.kt)("li",{parentName:"ul"},"Provides more trustworthiness than cookies or sessions")),(0,o.kt)("h2",{id:"the-need-for-json-web-token"},"The Need for JSON Web Token"),(0,o.kt)("p",null,"There are several reasons why applications use JSON Web Tokens for authentication:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"JWT is an excellent choice to be passed in HTML and HTTP environments due to its smaller footprint when compared to other types of tokens"),(0,o.kt)("li",{parentName:"ul"},"JSON Web Tokens can be signed using a shared secret and also by using public/private key pairs"),(0,o.kt)("li",{parentName:"ul"},"It is easier to work with JWT as JSON parsers are standard in most programming languages"),(0,o.kt)("li",{parentName:"ul"},"JWT is also suitable for implementing authorization in large-scale web applications")),(0,o.kt)("h3",{id:"structure-of-a-jwt"},"Structure of a JWT"),(0,o.kt)("p",null,"A JSON Web Token consists of:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Header \u2014Consists of two parts: the type of token (i.e., JWT) and the signing algorithm (i.e., HS512)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Payload \u2014Contains the claims that provide information about a user who has been authenticated along with other information such as token expiration time")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Signature \u2014Final part of a token that wraps in the encoded header and payload, along with the algorithm and a secret"))),(0,o.kt)("h2",{id:"jwt-use-cases"},"JWT Use Cases"),(0,o.kt)("p",null,"Some scenarios where JSON Web Tokens are useful:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Authorization - This is the most common scenario for using JWT. Once the user is logged in, each subsequent request will include the JWT, allowing the user to access routes, services, and resources that are permitted with that token.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Information Exchange - JSON Web Tokens are a good way of securely transmitting information between parties."))),(0,o.kt)("h2",{id:"step-1-generating-a-jwt"},"Step 1: Generating a JWT"),(0,o.kt)("p",null,"To generate a JWT, you need to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"jsonwebtoken")," library."),(0,o.kt)("p",null,"You can add (install) the ",(0,o.kt)("inlineCode",{parentName:"p"},"jsonwebtoken")," library by running the following command in your terminal:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm install jsonwebtoken\n")),(0,o.kt)("p",null,"And import it to your files like so:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const jwt = require('jsonwebtoken');\n")),(0,o.kt)("p",null,"or you can use the following import statement:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import jwt from 'jsonwebtoken';\n")),(0,o.kt)("p",null,"To generate a JWT, you need to pass in a payload. A payload is a JSON object that contains the information you want to store in the JWT."),(0,o.kt)("p",null,"You need three pieces of information to generate a JWT:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The secret key that you want to use to sign the JWT."),(0,o.kt)("li",{parentName:"ol"},"The payload that you want to store in the JWT."),(0,o.kt)("li",{parentName:"ol"},"The expiration time of the JWT.")),(0,o.kt)("p",null,"The token secret is a long random string used to encrypt and decrypt the data"),(0,o.kt)("p",null,"The piece of data that you hash in your token can be something either a user ID or username or a much more complex object. In either case, it should be an identifier for a specific user."),(0,o.kt)("p",null,"The token expiration time is a string, such as 1800 seconds (30 minutes), that details how long until the token will be invalid."),(0,o.kt)("p",null,"Here's an example of how to generate a JWT:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const secret = 'my-secret';\nconst payload = {\n    sub: '1234567890',\n    name: 'John Doe',\n    admin: true\n};\nconst token = jwt.sign(payload, secret, { expiresIn: '1h' });\nconsole.log(token);\n// eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjz1I8dUz27aevlE\n")),(0,o.kt)("p",null,"This can be sent back from a request to sign in or log in as a user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"app.post('/login', (req, res) => {\n    const { username, password } = req.body;\n    if (username === 'admin' && password === 'password') {\n        const payload = {\n            sub: '1234567890',\n            name: 'John Doe',\n            admin: true\n        };\n        const token = jwt.sign(payload, secret, { expiresIn: '1h' });\n        res.json({ token });\n    } else {\n        res.status(401).json({ message: 'Invalid credentials' });\n    }\n});\n")),(0,o.kt)("h2",{id:"step-2-verifying-authenticating-a-jwt"},"Step 2: Verifying (Authenticating) a JWT"),(0,o.kt)("p",null,"There are many ways to go about implementing a JWT authentication system in an Express.js application."),(0,o.kt)("p",null,"One approach is to utilize the middleware functionality in Express.js."),(0,o.kt)("p",null,"How it works is when a request is made to a specific route, you can have the (req, res) variables sent to an intermediary function before the one specified in the ",(0,o.kt)("inlineCode",{parentName:"p"},"app.get((req, res) => {})"),"."),(0,o.kt)("p",null,"The middleware is a function that takes parameters of (req, res, next)."),(0,o.kt)("blockquote",null,(0,o.kt)("h3",{parentName:"blockquote",id:"what-is-middleware"},"What is middleware?"),(0,o.kt)("p",{parentName:"blockquote"},"Middleware functions are functions that have access to the request object (req), the response object (res), and the next function in the application's request-response cycle. The next function is a function in the Express router that, when invoked, executes the middleware succeeding the current middleware.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Normal API without middleware\n",(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/27571455/181428008-38252c25-cec1-4ef5-9378-b02d15b7a723.png",alt:"image"}),"\nAPI with many middlewares\n",(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/27571455/181428101-e15eab5e-4261-4a34-be2f-7a00ce4ff6b6.png",alt:"image"}),"\nAPI with Auth Middleware\n",(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/27571455/181428151-3632acf4-9670-4372-97ad-9d15bd135bd2.png",alt:"image"}))),(0,o.kt)("p",null,"The req is the sent request (GET, POST, DELETE, PUT, etc.).\nThe res is the response that can be sent back to the user in a multitude of ways (",(0,o.kt)("inlineCode",{parentName:"p"},"res.sendStatus(200)"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"res.json()"),", etc.).\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"next")," is a function that can be called to move the execution past the piece of middleware and into the actual ",(0,o.kt)("inlineCode",{parentName:"p"},"app.get")," server response or next middleware."),(0,o.kt)("p",null,"Here is an example middleware function for authentication:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const authenticate = (req, res, next) => {\n    const token = req.headers['authorization'].split(' ')[1];\n\n    if (!token) {\n        return res.status(401).json({ message: 'No token provided.' });\n    }\n\n    jwt.verify(token, secret, (err, decoded) => {\n        if (err) {\n            return res.status(401).json({ message: 'Invalid token.' });\n        }\n\n        req.user = decoded;\n        next();\n    });\n};\n")),(0,o.kt)("p",null,"And now the ",(0,o.kt)("inlineCode",{parentName:"p"},"req.user")," has decoded data that we put as payload while generating JWT. In most case, it has an ID of the user. This means while logging in we put the user's information like user's ID, user's role, etc. in the token, and while verifying we get it back, and now the user will get only related data."),(0,o.kt)("p",null,"And an example of a request that would use that piece of middleware would resemble something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"app.get('/api', authenticate, (req, res) => {\n    res.json({ message: 'Welcome to the API' });\n});\n")),(0,o.kt)("p",null,"This code will ",(0,o.kt)("inlineCode",{parentName:"p"},"authenticate")," the token provided by the client, you see before ",(0,o.kt)("inlineCode",{parentName:"p"},"(req, res) => {}"),", I added another authenticate function, that'll act as the middleware. If the request has valid JWT, then it will proceed to (req, res) => {} otherwise the ",(0,o.kt)("inlineCode",{parentName:"p"},"authenticate")," function will send ",(0,o.kt)("inlineCode",{parentName:"p"},"res.status(401).json({ message: 'Invalid token.' })"),". So, if JWT is valid, it can proceed to the request. If it is not valid, it can be handled as an error."),(0,o.kt)("h2",{id:"how-to-send-jwt-from-postman"},"How to send JWT from Postman"),(0,o.kt)("p",null,"You can send a JWT from Postman by adding the following header to the request:\n",(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/27571455/181430225-b88e3326-262c-4915-ba01-f3711fecf91e.png",alt:"image"})),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Authorization: Bearer <token>\n")),(0,o.kt)("p",null,"The token is the JWT that you generated in the previous step (while logging in)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjz1I8dUz27aevlE\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This is a dummy token, you have to paste what was generated by auth APIs")),(0,o.kt)("p",null,"Or you can go to Authorization tab, click on dropdown next to ",(0,o.kt)("inlineCode",{parentName:"p"},"Type"),", and select Bearer.  Then paste the token in the text box.\n",(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/27571455/181430330-aa785c09-dcf2-43e8-8f9d-fc660b39f614.png",alt:"image"})),(0,o.kt)("h2",{id:"code"},"Code"),(0,o.kt)("p",null,"You can download the related code from ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mrizwanashiq/learning-express-js/tree/example/express-with-jwt"},"here")))}c.isMDXComponent=!0}}]);